Contacts Book
===
[![js-semistandard-style](https://img.shields.io/badge/code%20style-semistandard-brightgreen.svg?style=flat-square)](https://github.com/Flet/semistandard)
[![code style: prettier](https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square)](https://github.com/prettier/prettier)

### Tech stack:

- Node.js
- [Express.js](https://github.com/expressjs/express)
- [PostgreSQL](https://github.com/brianc/node-postgres)
- [React](https://github.com/facebook/react) (server-side rendering)

*Initial code generated by:* [`express-generator`](https://github.com/expressjs/generator)

### How to start development:

##### 1. Prepare the database

Change your database credential information at `./db/pool.js`:

```js
let configObj = {
    user: 'garyle',// your postgresql user
    host: 'localhost',// most of the time it will be localhost. If you use docker, please check their document
    database: 'adrsbook',// the database that your postgresql user account has rights to manage
    password: 'bdd8OC0qgd',// postgresql user account's password
    port: 5432// port number that your postgresql server is listening
};
```

##### 2. Create those tables with their schemas:

```sql
--install extension uuid generator
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE IF NOT EXISTS account (
    id UUID PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    username VARCHAR(20) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    facebook_id VARCHAR(255) UNIQUE,
    birth DATE CHECK (birth < CURRENT_DATE),
    email VARCHAR(355) UNIQUE CHECK (email LIKE '%@%'),
    phone VARCHAR(15),
    nicename VARCHAR(25),
    created_on TIMESTAMP NOT NULL,
    last_login TIMESTAMP,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    salt CHAR(10) NOT NULL
);

CREATE TABLE IF NOT EXISTS addressbook (
    id UUID PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    -- account_id UUID REFERENCES account (id) ON UPDATE CASCADE ON DELETE SET NULL,
    name VARCHAR(25),
    color VARCHAR(30) CHECK (color LIKE 'rgb(%)' OR color LIKE 'rgba(%)' OR color LIKE '#%' OR color LIKE 'hsl(%)')
);

--prepare for future feature: share addressbook to other users
CREATE TABLE account_addressbook (
    account_id UUID REFERENCES account (id) ON UPDATE CASCADE ON DELETE CASCADE,
    addressbook_id UUID REFERENCES addressbook (id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS contact (
    id UUID PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    addressbook_id UUID REFERENCES addressbook (id) ON UPDATE CASCADE ON DELETE CASCADE,
    account_id UUID REFERENCES account (id) ON UPDATE CASCADE ON DELETE SET NULL,
    birth DATE CHECK (birth < CURRENT_DATE),
    email VARCHAR(355),
    phone VARCHAR(15),
    note TEXT,
    name VARCHAR(30) NOT NULL,
    color VARCHAR(30) CHECK (color LIKE 'rgb(%)' OR color LIKE 'rgba(%)' OR color LIKE '#%' OR color LIKE 'hsl(%)'),
    website VARCHAR(355) CHECK (website LIKE 'http://%' OR website LIKE 'https://%'),
    labels VARCHAR(300),
    avatar_url VARCHAR(355)
);
```

##### 3. Folow `connect-pg-simple`'s [installation guide](https://www.npmjs.com/package/connect-pg-simple#installation)

##### 4. Start the development server

```
npm start
```

If you make it right, your console will log: `Database is connected!` after you run one of these command to run the development server: `npm start` or:

##### Deploy the server:

```
npm run deploy
```

### [Todo](https://github.com/lvnam96/contactsbook/projects)

### [Milestones](https://github.com/lvnam96/contactsbook/milestones)

### License
MIT &copy; 2019
